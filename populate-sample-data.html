<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Data Population Script</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .progress {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-bar {
            height: 100%;
            background-color: #28a745;
            width: 0%;
            transition: width 0.3s ease;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sample Data Population Script</h1>
            <p>This script will populate your account with comprehensive sample data for News Radar and Threat Tracker.</p>
        </div>

        <div id="status-container"></div>

        <div class="section">
            <h3>What will be created:</h3>
            <ul>
                <li><strong>News Radar:</strong> 9 news sources + 23 keywords</li>
                <li><strong>Threat Tracker:</strong> Various vendor, hardware, and threat keywords</li>
            </ul>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div id="progress-text">Ready to start</div>

        <div style="text-align: center;">
            <button id="populate-btn" onclick="populateData()">Start Data Population</button>
            <button id="check-btn" onclick="checkDataStatus()">Check Current Data</button>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        // Check if data has already been populated
        const HAS_BEEN_POPULATED_KEY = 'sampleDataPopulated';
        
        // API base URL
        const API_BASE = window.location.origin + '/api';
        
        // Sample data configuration
        const SAMPLE_DATA = {
            newsRadar: {
                sources: [
                    { name: "AM Best", url: "https://news.ambest.com/PR/" },
                    { name: "Cincinnati Business Journal", url: "https://www.bizjournals.com/cincinnati/news/" },
                    { name: "Forbes", url: "https://forbes.com/news/" },
                    { name: "Insurance Insider", url: "https://insuranceinsiderus.com/news" },
                    { name: "Investing.com", url: "https://investing.com/news" },
                    { name: "NY Times", url: "https://nytimes.com/" },
                    { name: "Reinsurance News", url: "https://www.reinsurancene.ws/news" },
                    { name: "The Insurer", url: "https://www.theinsurer.com/ti/news/" },
                    { name: "Yahoo Finance", url: "https://finance.yahoo.com/news/" }
                ],
                keywords: [
                    "AIG", "Core Specialty", "Enstar", "Lancer Insurance", "American Surety",
                    "Starstone Specialty", "Starstone National", "Starstone", "Swiss Re",
                    "American Life", "AMBAC", "Vanguard", "OpenAI", "President", "Market",
                    "Dow", "NASDAQ", "S&P500", "Tariff", "Tesla", "Trump", "Musk"
                ]
            },
            threatTracker: {
                vendors: [
                    "Access Point Technology Consulting, LLC", "Accurate Background", "Automatic Data Processing Group",
                    "alangray", "Altair Integrated Services", "Amazon Web Services", "astound", "atlassian",
                    "bitraser", "Bitsight Technologies", "BlackLine", "Bond-Pro, Inc.", "Chard Snyder",
                    "Cigna", "Cisco", "claraanalytics", "Clearwater Analytics", "Cloudflare",
                    "collectone", "contezza", "contractsafe", "Corporation Service Group of Companies",
                    "darka", "Darktrace", "Datadog", "delinea", "Deloitte U.S.", "Delta Dental of Ohio",
                    "Distinguished Programs Group", "DocuSign", "Duck Creek Technologies", "Dynatrace LLC",
                    "Enghouse Systems", "EQuest LLC", "Flashpoint", "Focused Consulting", "GENPACT",
                    "CARET", "Nitro Software, Inc.", "Green Leaf Consulting Group", "GUIDEWIRE",
                    "harmon.ie", "Arbitration Forums, Inc.", "hyperexponential", "intellectdesign",
                    "Jamf", "jetfiletech", "John Hancock", "Karen Clark & Company", "KEYSYS",
                    "Latitude Subrogation Service", "RELX Ltd.", "Lincoln Financial Group", "Lifesize",
                    "Lucid Software Inc.", "lumivero", "mandiant", "Microsoft", "Mitchell International, Inc.",
                    "Northern Trust Careers", "Ntirety", "Omegablack, Inc.", "omegaconsulting", "One Inc",
                    "Palo Alto Networks, Inc.", "Peakon", "CARET Legal", "profisee", "proofinsurance",
                    "Proofpoint Corporation", "Qualys", "Quick Silver Systems, Inc.", "Qumodity",
                    "rhymetec", "RSM US LLP", "SendGrid", "Sovos Compliance", "thequakerproject",
                    "tinubu", "tkcllcconsulting", "Topbloc, LLC", "Trace3, Inc.", "TriTech Services Inc.",
                    "Vision Service Plan Inc", "Ward Group", "Willis Towers Watson", "Workday",
                    "Workiva Inc.", "Zscaler"
                ],
                hardware: [
                    "Windows", "Mackbook", "Surfacebook", "iPhone", "Galaxy", "Dell Latitude",
                    "Active Directory (AD)", "Azure", "AWS", "Entra"
                ]
            }
        };

        // Logging functions
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function showStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            container.appendChild(statusDiv);
            
            // Remove status after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }

        function updateProgress(percentage, text) {
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = text;
        }

        // API helper functions
        async function makeRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                log(`API Error for ${endpoint}: ${error.message}`, 'error');
                throw error;
            }
        }

        async function checkAuthentication() {
            try {
                await makeRequest('/auth/check');
                return true;
            } catch (error) {
                return false;
            }
        }

        // Data population functions
        async function populateNewsRadarSources() {
            log('Populating News Radar sources...');
            let created = 0;
            
            for (const source of SAMPLE_DATA.newsRadar.sources) {
                try {
                    await makeRequest('/news-tracker/sources', {
                        method: 'POST',
                        body: JSON.stringify(source)
                    });
                    created++;
                    log(`✓ Created source: ${source.name}`);
                } catch (error) {
                    log(`✗ Failed to create source: ${source.name} - ${error.message}`, 'error');
                }
            }
            
            return created;
        }

        async function populateNewsRadarKeywords() {
            log('Populating News Radar keywords...');
            let created = 0;
            
            for (const term of SAMPLE_DATA.newsRadar.keywords) {
                try {
                    await makeRequest('/news-tracker/keywords', {
                        method: 'POST',
                        body: JSON.stringify({ term })
                    });
                    created++;
                    log(`✓ Created keyword: ${term}`);
                } catch (error) {
                    log(`✗ Failed to create keyword: ${term} - ${error.message}`, 'error');
                }
            }
            
            return created;
        }

        async function populateThreatTrackerKeywords() {
            log('Populating Threat Tracker keywords...');
            let created = 0;
            
            // Create vendor keywords
            for (const term of SAMPLE_DATA.threatTracker.vendors) {
                try {
                    await makeRequest('/threat-tracker/keywords', {
                        method: 'POST',
                        body: JSON.stringify({ 
                            term, 
                            category: 'vendor' 
                        })
                    });
                    created++;
                    log(`✓ Created vendor keyword: ${term}`);
                } catch (error) {
                    log(`✗ Failed to create vendor keyword: ${term} - ${error.message}`, 'error');
                }
            }
            
            // Create hardware keywords
            for (const term of SAMPLE_DATA.threatTracker.hardware) {
                try {
                    await makeRequest('/threat-tracker/keywords', {
                        method: 'POST',
                        body: JSON.stringify({ 
                            term, 
                            category: 'hardware' 
                        })
                    });
                    created++;
                    log(`✓ Created hardware keyword: ${term}`);
                } catch (error) {
                    log(`✗ Failed to create hardware keyword: ${term} - ${error.message}`, 'error');
                }
            }
            
            return created;
        }

        async function checkDataStatus() {
            log('Checking current data status...');
            
            try {
                const isAuthenticated = await checkAuthentication();
                if (!isAuthenticated) {
                    showStatus('Please log in first to check data status', 'warning');
                    return;
                }

                // Check News Radar data
                const sources = await makeRequest('/news-tracker/sources');
                const keywords = await makeRequest('/news-tracker/keywords');
                
                // Check Threat Tracker data
                const threatKeywords = await makeRequest('/threat-tracker/keywords');
                
                log(`Current data status:`);
                log(`- News Radar Sources: ${sources.length}`);
                log(`- News Radar Keywords: ${keywords.length}`);
                log(`- Threat Tracker Keywords: ${threatKeywords.length}`);
                
                const hasData = sources.length > 0 || keywords.length > 0 || threatKeywords.length > 0;
                const isPopulated = localStorage.getItem(HAS_BEEN_POPULATED_KEY) === 'true';
                
                if (isPopulated && hasData) {
                    showStatus('Sample data has already been populated', 'success');
                } else if (hasData) {
                    showStatus('Some data exists but may not be from sample population', 'info');
                } else {
                    showStatus('No data found - ready for population', 'info');
                }
                
            } catch (error) {
                showStatus('Error checking data status', 'error');
                log(`Error: ${error.message}`, 'error');
            }
        }

        async function populateData() {
            // Check if already populated
            if (localStorage.getItem(HAS_BEEN_POPULATED_KEY) === 'true') {
                const proceed = confirm('Sample data appears to have been populated already. Continue anyway?');
                if (!proceed) {
                    showStatus('Population cancelled', 'warning');
                    return;
                }
            }

            // Check authentication
            const isAuthenticated = await checkAuthentication();
            if (!isAuthenticated) {
                showStatus('Please log in first to populate data', 'error');
                log('Authentication required - please log in to your account first');
                return;
            }

            // Disable button during population
            const populateBtn = document.getElementById('populate-btn');
            populateBtn.disabled = true;
            populateBtn.textContent = 'Populating...';

            try {
                log('Starting sample data population...');
                updateProgress(0, 'Starting...');

                // Step 1: Populate News Radar Sources
                updateProgress(10, 'Creating News Radar sources...');
                const sourcesCreated = await populateNewsRadarSources();
                
                // Step 2: Populate News Radar Keywords
                updateProgress(40, 'Creating News Radar keywords...');
                const keywordsCreated = await populateNewsRadarKeywords();
                
                // Step 3: Populate Threat Tracker Keywords
                updateProgress(70, 'Creating Threat Tracker keywords...');
                const threatKeywordsCreated = await populateThreatTrackerKeywords();
                
                updateProgress(100, 'Population complete!');
                
                // Mark as populated
                localStorage.setItem(HAS_BEEN_POPULATED_KEY, 'true');
                
                const summary = `
Population completed successfully!
- News Radar Sources: ${sourcesCreated} created
- News Radar Keywords: ${keywordsCreated} created
- Threat Tracker Keywords: ${threatKeywordsCreated} created
                `;
                
                log(summary);
                showStatus('Sample data population completed successfully!', 'success');
                
            } catch (error) {
                log(`Population failed: ${error.message}`, 'error');
                showStatus('Population failed - see log for details', 'error');
                updateProgress(0, 'Failed');
            } finally {
                // Re-enable button
                populateBtn.disabled = false;
                populateBtn.textContent = 'Start Data Population';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('Sample Data Population Script loaded');
            checkDataStatus();
        });
    </script>
</body>
</html>